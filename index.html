<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KPI Rəy Forması</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">

    <!-- Step 1: Name Entry -->
    <section class="step active" id="step1">
      <div class="card welcome-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="User Icon" class="icon" />
        <h2>Xoş gəlmisən 👋</h2>
        <p>Zəhmət olmasa ad və soyadınızı daxil edin</p>
        <input type="text" id="responder" placeholder="Məs: Elvin Məmmədov" required />
        <button onclick="goToStep2()">Davam et</button>
      </div>
    </section>

    <!-- Step 2: Department & Employee -->
    <section class="step" id="step2">
      <div class="card">
        <h2>Əməkdaş Seçimi</h2>
        <label>Rəy verdiyiniz şöbə:</label>
        <select id="department" onchange="populateEmployees()">
          <option value="">-- Şöbə --</option>
          <option value="Satış">Satış</option>
          <option value="Təchizat">Təchizat</option>
          <option value="İnsan Resursları">İnsan Resursları</option>
          <option value="Maliyyə">Maliyyə</option>
          <option value="İT">İT</option>
        </select>

        <div id="employeeContainer" class="hidden">
          <label>Əməkdaşın adı:</label>
          <select id="rated">
            <option value="">-- Əməkdaş --</option>
          </select>
        </div>

        <button onclick="goToStep3()">Davam et</button>
      </div>
    </section>

    <!-- Step 3: Questions -->
    <section class="step" id="step3">
      <form class="card" id="feedbackForm" onsubmit="submitFeedback(event)">
        <h2>Rəy Sualları</h2>
        <div id="questions"></div>
        <button type="submit">Rəyi Göndər</button>
      </form>
    </section>

  </div>

  <script>
    let responderName = "";

    const employeeData = {
      "Satış": ["Aysel Məmmədova", "Tural Əliyev"],
      "Təchizat": ["Rauf Qasımov", "Fidan Həsənli"],
      "İnsan Resursları": ["Nigar Əliyeva", "Nihat Hüseynov"],
      "Maliyyə": ["Kamran Məmmədov"],
      "İT": ["Elvin Orucov"]
    };

    const questions = [
      "Emosional Zəka", "Liderlik Bacarığı", "Kreativlik",
      "Danışıqlar Bacarığı", "Müştəri Yönümlülük", "Şəbəkələşmə",
      "Analitik Düşüncə", "Qərarvermə Bacarığı", "Etika və Dürüstlük",
      "İT Bacarığı", "Ünsiyyət Bacarığı", "Komanda İşi", "Vaxtın İdarə Edilməsi",
      "Problem Həll Etmə", "Öyrənməyə Açıq Olmaq", "Məsuliyyətlilik",
      "Elastiklik", "Detala Diqqət", "Motivasiya", "Stres İdarəçiliyi"
    ];

    function switchStep(from, to) {
      document.getElementById(`step${from}`).classList.remove("active");
      document.getElementById(`step${to}`).classList.add("active");
    }

    function goToStep2() {
      const name = document.getElementById("responder").value.trim();
      if (!name) return alert("Zəhmət olmasa adınızı daxil edin.");
      responderName = name;
      switchStep(1, 2);
    }

    function populateEmployees() {
      const dept = document.getElementById("department").value;
      const ratedSelect = document.getElementById("rated");
      const container = document.getElementById("employeeContainer");

      ratedSelect.innerHTML = '<option value="">-- Əməkdaş --</option>';

      if (dept && employeeData[dept]) {
        employeeData[dept].forEach(person => {
          const opt = document.createElement("option");
          opt.value = person;
          opt.textContent = person;
          ratedSelect.appendChild(opt);
        });
        container.classList.remove("hidden");
      } else {
        container.classList.add("hidden");
      }
    }

    function goToStep3() {
      const rated = document.getElementById("rated").value;
      if (!rated) return alert("Zəhmət olmasa əməkdaş seçin.");
      switchStep(2, 3);
      renderQuestions();
    }

    function renderQuestions() {
      const container = document.getElementById("questions");
      container.innerHTML = "";
      questions.forEach((q, i) => {
        const n = i + 1;
        container.innerHTML += `
          <div class="question">
            <label>${n}. ${q}</label>
            <input type="range" id="q${n}" min="1" max="5" value="3" oninput="document.getElementById('val${n}').textContent = this.value">
            <div class="scale"><span>1</span><span>2</span><span id="val${n}">3</span><span>4</span><span>5</span></div>
            <textarea id="c${n}" placeholder="Açıqlama (istəyə bağlı)"></textarea>
          </div>
        `;
      });
    }

    async function submitFeedback(event) {
      event.preventDefault();
      const data = {
        responder: responderName,
        department: document.getElementById("department").value,
        rated: document.getElementById("rated").value
      };

      for (let i = 1; i <= 20; i++) {
        data[`q${i}`] = document.getElementById(`q${i}`).value;
        data[`c${i}`] = document.getElementById(`c${i}`).value;
      }

      const response = await fetch('https://script.google.com/macros/s/AKfycbxWfsu6XCki3Ydhdr_oGPG13RKx0A2KJx-aFvqyV7vwDxiyjB2f0xBfDPxk3vML2Ku0eA/exec', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      });

      const result = await response.text();
      alert(result);
      location.reload();
    }
  </script>
</body>
</html>
